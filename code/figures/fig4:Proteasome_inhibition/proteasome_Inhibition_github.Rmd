---
title: "Proteasome inhibition"
output: 
    html_document: 
    df_print: paged
author: "Sukanya Das"
date: "`r Sys.time()`"
---
Main and supplemental figures with section "Estimating single cell proteasomal decay rates" 
```{r}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, fig.align = "center")
```

Libraries to load
```{r}
library(data.table)
library(tidyverse)
library(reshape2)
library(gganimate)
library(ggridges)
library(ggpubr)
library(patchwork)
library(ggplot2)
library(latex2exp)
library(parallel)
```


#Loading data
```{r}
#decay parameters with the cellular atttributes
static.prtIn <- read.csv("../../../data/paper_pup1_prtinh_param_cell.csv")
static.prtIn <-  static.prtIn %>% 
  mutate(treatment = factor(treatment , levels = c("DMSO","1uM","2.5uM","5uM")),
         colony = factor(colony, levels = c(1:12))) 
```


timeseries dataframe
```{r}
#timelapse GFP trace for each cell
timeseries.prtIn <- read.csv("../../../data/paper_pup1_prtinh_timeseries.csv")
timeseries.prtIn <- timeseries.prtIn %>% 
  mutate( treatment = factor(treatment , levels = c("DMSO","1uM","2.5uM","5uM")))
```
#Main figure
##Panel A
ggrides
with DMSO, 1uM, 2.5uM and 5uM MG132
```{r}
ggRigd.PrtIng <- timeseries.prtIn %>% 
  group_by(cell.id) %>% 
  mutate(I0_It = gfpMeanBgAFsub/gfpMeanBgAFsub[1], 
         image.no = image.no -1) %>% 
  filter(image.no > 0) %>% 
  ggplot(.,aes(x = I0_It, y = factor(image.no, levels = c(30:1)),
               fill = factor(treatment , levels = c("5uM","2.5uM","1uM","DMSO")), 
               color = factor(treatment , levels = c("5uM","2.5uM","1uM","DMSO"))))+
  stat_density_ridges(geom = "density_ridges_gradient" , 
                      quantiles = 2, 
                      quantile_lines = TRUE , 
                      aes(height = ..ndensity..), 
                      rel_min_height = 0.01, 
                      size = 0.2) +
  scale_fill_manual(values = alpha(c( "indianred2","dodgerblue","lightskyblue2","seagreen2"), 0.8), name = NULL,
                    label = c(expression(paste("5", mu, "M   ")),
                              expression(paste("2.5", mu, "M")),
                              expression(paste("1", mu, "M   ")),
                              "DMSO"))+
  scale_color_manual(values = c( "indianred4","dodgerblue4","lightskyblue4","seagreen4"), name = NULL, 
                      label = c(expression(paste("5", mu, "M   ")),
                              expression(paste("2.5", mu, "M")),
                              expression(paste("1", mu, "M   ")),
                              "DMSO"))+
  # facet_wrap(~treatment, ncol = 4)+
  theme_ridges(line_size = 0.3)+
  theme_pubr()+
  theme(text = element_text(size = 8), 
        legend.background = element_blank(),
        legend.direction = "vertical",
        legend.position = c(0.25,factor(2, levels = 2)),
        legend.key.size = unit(2 ,"mm"),
        axis.line = element_line(size = 0.1),
        axis.ticks = element_line(size = 0.2),
        strip.background = element_blank())+
  # scale_x_log10(labels = scales::trans_format("log10", scales::math_format(10^.x)))+
  ylab(TeX("\\leftarrow\\leftarrow\\,Time\\,point"))+
  scale_x_continuous(breaks = seq(0,1,by = 0.25), name = "Normalized GFP Mean Intensity\n[A.U]", limits = c(-0.1,1.1))+
  labs(title = "A")

ggRigd.PrtIng
```
###Saving figure
```{r}
ggsave(plot = ggRigd.PrtIng, path = "../../../fig_pdfs/fig_PrtInh/", filename = "ggRidg_prtInh.png", width = 2.5, height = 4)
ggsave(plot = ggRigd.PrtIng, path = "../../../fig_pdfs/fig_PrtInh/", filename = "ggRidg_prtInh.pdf", width = 2.5, height = 4)
```
##Panel B : gfp mean boxplot
```{r}
gfp.int.dist.plt <- static.prtIn %>% 
  ungroup() %>% 
  ggplot(.,aes(y = gfp.mean.bg.af.sub.new, x = treatment ,fill = treatment))+
  geom_boxplot(outlier.size = 0.2, lwd = 0.1)+
  theme_pubr()+
  scale_fill_manual(values = alpha(c("seagreen4","lightskyblue4","dodgerblue4","indianred4"), 0.8), name = NULL)+
  guides(fill = "none")+
  ylab("GFP intensity [A.U]")+
  theme(axis.title.x = element_blank(), 
        axis.line = element_line(size = 0.1),
        axis.ticks = element_line(size = 0.2),
        text = element_text(size = 8), 
        legend.position = c(0.2,0.9), 
        legend.direction = "horizontal", 
        legend.background = element_blank(), 
        legend.key.size = unit(3 ,"mm"),
        legend.spacing.y = unit(-0.25, "cm"))+
  stat_compare_means(size = 2, method = "t.test", comparisons = my_comp, label = "p.signif")+
  labs(title = "B")
gfp.int.dist.plt
```
##Panel C : dist of half lives
```{r}
avg.half.prtIn <- static.prtIn %>% 
  mutate(t.half = log(2)/dy) %>% 
  group_by(treatment) %>% 
  summarise(avg.t = median(t.half),
            no.cell = NROW(t.half))

my_comp <- list(c("DMSO","1uM"), c("DMSO","2.5uM"),
                c("DMSO","5uM"),c("1uM","2.5uM"),
                c("1uM","5uM"), c("2.5uM","5uM"))
hl.box.prtIn <- static.prtIn %>% 
  ggplot(.,aes(y = log(2)/dy, x = treatment, fill = treatment))+
  geom_boxplot(outlier.size = 0.2, lwd = 0.1)+
  # geom_signif(comparisons = my_comp, 
  #             map_signif_level=TRUE)+
  theme_pubr()+
  scale_fill_manual(values = alpha(c("seagreen4","lightskyblue4","dodgerblue4","indianred4"), 0.8), name = NULL)+
  guides(fill = "none")+
  ylab("Half-life [Min.]")+
  theme(axis.title.x = element_blank(), 
        axis.line = element_line(size = 0.1),
        axis.ticks = element_line(size = 0.2),
        text = element_text(size = 8), 
        legend.position = c(0.2,0.9), 
        legend.direction = "horizontal", 
        legend.background = element_blank(), 
        legend.key.size = unit(3 ,"mm"),
        legend.spacing.y = unit(-0.25, "cm"))+
  stat_compare_means(size =2, method = "t.test", comparisons = my_comp,label = "p.signif")+
  scale_y_log10()+
  labs(title = "C")

hl.box.prtIn
```
##Panel D: CV in half-lives
###bootstrapping the cv in half life
```{r}
#function: cv in half life
cv.boot.fn <- function(data, i){
  data1 <- data %>% 
    ungroup() %>% 
    dplyr::select(dy, t.half)
  
  a1 <- data1[i,]
  
  cv <- sd(a1$t.half)/mean(a1$t.half)
  return(cv)
}

set.seed(1)
#cv in half life bootstrap
#df
cv.thalf.PrtIn <- static.prtIn %>% 
  dplyr::select(dy,gfp.mean.bg.af.sub.new, treatment, colony) %>% 
  ungroup() %>% 
  mutate(treatment = factor(treatment , levels = c("DMSO","1uM","2.5uM","5uM")) ,
         t.half = log(2)/dy) 
#bootstrapping
cv.hl.prtInh.boot.lst <- cv.thalf.PrtIn %>% 
  split(list(.$treatment)) %>% 
  map(.,function(a){
    boot(data = a, statistic = cv.boot.fn, R = 2000)
  })

#confidence interval
cv.prtInh.hl.ci <-  cv.hl.prtInh.boot.lst %>% 
  map(.,function(b){
    boot.ci(boot.out = b, conf = 0.95, type = "bca")
  })

cv.prtInh.hl.ci

```

making df
```{r}
cv.hl.prtInh.boot.df <- cv.hl.prtInh.boot.lst %>% 
  map(.,summary %>% as.data.frame) %>% bind_rows(.id = "treatment")

cv.prtInh.hl.ci.df <- cv.prtInh.hl.ci %>% 
  map(.,function(a){
    data.frame(ci.low = a$`bca`[4],
               ci.high = a$`bca`[5])
  }) %>% 
  bind_rows(.id = "treatment")

cv.prtInh.hl.df <- cv.hl.prtInh.boot.df %>% 
  left_join(.,cv.prtInh.hl.ci.df, by = "treatment")

```

###plot: CV in half-life
```{r}
cv.hl.prtin.plt <- cv.prtInh.hl.df  %>% 
  mutate(treatment =  factor(treatment, levels = c("DMSO","1uM","2.5uM","5uM"))) %>% 
  ggplot(.,aes(y = value.original, 
               x = treatment))+
  geom_col(width = 0.2, position = "dodge")+
  geom_errorbar( aes(x=treatment, ymin=ci.low, ymax=ci.high), 
                 width=0.15, size=0.3,
                 position = position_dodge(0.2))+
  ylab(TeX("Noise \\textit{(CV)} in half-life")) +
  labs(title ="D")+
  theme_pubr()+
  theme(axis.title.x = element_blank(), 
        axis.line = element_line(size = 0.1),
        axis.ticks = element_line(size = 0.2),
        text = element_text(size = 8), 
        legend.position = c(0.4,0.9), 
        legend.direction = "horizontal", 
        legend.background = element_blank(), 
        legend.key.size = unit(3 ,"mm"),
        legend.spacing.y = unit(-0.25, "cm"),
        plot.background = element_rect(fill = "transparent"))
cv.hl.prtin.plt
```

##Panel E: 
###mechanistically calculating CV(t) in GFP intensity
```{r}
noise.cvt.fn <- function(cv0, cvd, md,t){
  #cv0 = gfp expression cv, 
  #cvd = decay rate CV,
  #md = mean decay rate
  cvt <- (-1+(1+cv0^2)*((1+(cvd^2)*md*t)^(2/cvd^2))*((1+2*(cvd^2)*md*t)^-(1/cvd^2)))/(cv0^2)
  return(cvt)
}

```

```{r}
cv.d.prtInh <- static.prtIn %>% 
  dplyr::select(dy,gfp.mean.bg.af.sub.new, treatment, colony,degron) %>% 
  na.omit() %>% 
  ungroup() %>% 
  mutate(t.half = log(2)/dy) %>% 
  group_by(treatment) %>% 
  summarise(cv.d = sd(dy)/mean(dy), 
            mean.d = mean(dy), 
            cv.gfp.0 = sd(gfp.mean.bg.af.sub.new)/mean(gfp.mean.bg.af.sub.new),
            n.cell = NROW(dy),
            gfp.cor = cor(gfp.mean.bg.af.sub.new, dy)) %>% 
  dplyr::rename("Treatment" = "treatment") 
cv.d.prtInh
```

###fitting the parameters of the cvt eq
```{r}
library(optimx)
#function to fit the transient CV in GFP eq.
cvt.opt.fn<- function(df1, par){ 
  #fitting for the CV in gfp at t = 0 
  cv0.a <- par[1] #gfp cv0
  # cvd.b <- par[2] #cv decay rate
  
  mech.cv.df <- df1 %>% 
    mutate(mech.cvt2 = noise.cvt.fn(cv0 = cv0.a, 
                                    cvd = cv.d,
                                    md = mean.d,
                                    t = time.min), 
           cvt2.err = (norm.cv2 - mech.cvt2)^2) %>% 
    summarise(sum.err = sum(cvt2.err))
  
  return(mech.cv.df$sum.err)
}
```

```{r}
#Split the dataframe based on the degron 
list.cvt.opt.prtIn <- timeseries.prtIn %>% 
  dplyr::rename("Treatment" = "treatment") %>% 
  group_by(Treatment,image.no) %>%
  summarise(cv.gfp = sd(gfpMeanBgAFsub)/mean(gfpMeanBgAFsub),
            n.cell = NROW(gfpMeanBgAFsub), 
            time.min = signif(mean(delta.time)/60, digits = 3)) %>% 
  group_by(Treatment) %>% 
  mutate(norm.cv = cv.gfp/cv.gfp[1],
         norm.cv2 = norm.cv^2) %>% 
  left_join(.,cv.d.prtInh, by = c("Treatment", "n.cell")) %>% 
  split(.$Treatment)


#Run the optimization 
cvt.fits.prtIn <- lapply(c(1,2,3,4), function(a){ 
  
  df <- list.cvt.opt.prtIn[[a]]
  
  par.optim <- c(0.2) #cv.gfp at t=0
  
  names(par.optim) <- c("gfp.cv0")
  
  optimx(par = par.optim, 
         fn = cvt.opt.fn, 
         method = "L-BFGS-B", 
         lower = c(0.1), 
         upper = c(0.6),
         df1 = df,
         itnmax = 100000)
})

```

```{r}
#Making dataframes
cvt.fits.df.prtIn <- cvt.fits.prtIn %>% bind_rows(.id = "Treatment") %>% 
  mutate(Treatment = case_when(Treatment == "1" ~"DMSO",
                            Treatment == "2" ~ "1uM",
                            Treatment == "3" ~ "2.5uM",
                            Treatment == "4" ~ "5uM")) 
cvt.fits.df.prtIn
```

###getting the cv2(t) fits
```{r}
mech.noise.df <- timeseries.prtIn %>% 
  dplyr::rename("Treatment" = "treatment") %>% 
  group_by(Treatment,image.no) %>%
  summarise(cv.gfp = sd(gfpMeanBgAFsub)/mean(gfpMeanBgAFsub),
            n.cell = NROW(gfpMeanBgAFsub), 
            time.min = signif(mean(delta.time)/60, digits = 3)) %>% 
  group_by(Treatment) %>% 
  mutate(norm.cv = cv.gfp/cv.gfp[1],
         norm.cv2 = norm.cv^2) %>% 
  left_join(.,cv.d.prtInh, by = c("Treatment", "n.cell")) %>% 
  left_join(.,cvt.fits.df.prtIn %>% 
              dplyr::select(Treatment, gfp.cv0), by = "Treatment") %>% 
  mutate(Treatment = factor(Treatment, levels = c("DMSO","1uM","2.5uM","5uM"))) %>% 
  mutate( fits.cvd = noise.cvt.fn(cv0 = gfp.cv0,
                                  md = mean.d, 
                                 cvd = cv.d,
                                 t = time.min))

mech.noise.df
```

###bootstrooping on cv2(t)/cv2(0)
grouping by each timepoint and then resampling in each timepoint
```{r}
library(dplyr)
library(boot)
# Define function to compute CV
cv_fun <- function(x) {
  sd(x) / mean(x)
}

# Define function to compute bootstrap CV ratio
compute_ratio <- function(df) {
  # Bootstrap resample within each time point
  df_boot <- df %>%
    group_by(image.no) %>%
    sample_n(size = n(), replace = TRUE) %>%
    ungroup()
  
  # Compute CV for each time point
  cv_values <- df_boot %>%
    group_by(image.no) %>%
    summarise(cv = cv_fun(gfpMeanBgAFsub)) %>%
    pull(cv)
  
  # Return CV ratio for each time point
  return((cv_values / cv_values[1])^2)
}

# Perform bootstrap resampling
set.seed(123)
R <- 1000  # Number of bootstrap resamples

bootstrap_cv2.prtInh <- timeseries.prtIn %>% 
  split(.$treatment) %>% 
  map(.,function(a){
    replicate(R, compute_ratio(df = a), simplify = "array")
  })

# Compute confidence intervals
ci_cv2.prtInh <- bootstrap_cv2.prtInh %>% 
  map(.,function(a){
    lower <- apply(a, 1, function(x) quantile(x, 0.025)) 
    upper <- apply(a, 1, function(x) quantile(x, 0.975)) 
    cv2.mean <- apply(a, 1, function(x) mean(x)) 
  
    data.frame(image.no= unique(timeseries.prtIn$image.no), lower,cv2.mean, upper,
                 degron = "yeGFP-mODC")
  }) %>% 
  bind_rows(.id = "Treatment")
```

###plot
```{r}
trans.cvt.prtIn.plt <- ci_cv2.prtInh %>% 
  left_join(.,mech.noise.df, by = c("Treatment","image.no")) %>% 
  dplyr::select(Treatment, image.no, time.min, norm.cv2,lower,upper,fits.cvd) %>% 
  filter(Treatment %in% c("DMSO","5uM")) %>% 
  mutate(Treatment = factor(Treatment, levels = c("DMSO","1uM","2.5uM","5uM"))) %>% 
  ggplot(.,aes(x = time.min, y = norm.cv2, color = Treatment))+
  geom_point(size = 0.35)+
  geom_errorbar(aes(x = time.min, ymin = lower, ymax = upper,color = Treatment),
                width = 0.2, size = 0.2, 
                position = position_dodge(0.2))+
  geom_line(data = mech.noise.df %>% 
               filter(Treatment %in% c("DMSO","5uM")) ,aes(x = time.min, y = fits.cvd), 
            size= 0.3)+
  scale_color_manual(values = c("seagreen4","indianred4"), name = NULL, 
                     labels = c("DMSO         ",
                                expression(paste("5", mu, "M MG132"))))+
  theme_pubr()+
  theme(text = element_text(size = 8), 
        strip.background = element_blank(),
        legend.background = element_blank(),
        legend.direction = "vertical",
        legend.key.size = unit(4,"mm"),
        legend.position = c(0.5,1),
        axis.line = element_line(size = 0.1),
        axis.ticks = element_line(size = 0.2))+
  scale_x_continuous(breaks = c(0,5,10,15,20,25), limits = c(0,25))+
  scale_y_continuous(breaks = seq(1,8, by = 0.5), limits = c(0.5,8))+
  ylab(bquote(atop("Normalized noise"~ (italic(CV^2)), "in GFP intensities")))+
  xlab("Time (mins)")+
  labs(title = "E")

trans.cvt.prtIn.plt
```
##patchwork
```{r fig.height= 6, fig.width= 6.5}
l.t <- ggRigd.PrtIng
# &theme(legend.position = "bottom")
m.t <- gfp.int.dist.plt
r.t <- hl.box.prtIn
m.b <- cv.hl.prtin.plt
r.b <- trans.cvt.prtIn.plt

m <- m.t/m.b
r <- r.t/r.b

l.m.r <- (l.t|plot_spacer()|m|plot_spacer()|r)+
  plot_layout(widths = c(0.4, -0.08,0.4,-0.08,0.4))
l.m.r
```
##Saving figures
```{r}
ggsave(filename = "prtIn.png",
       plot = l.m.r, 
       path = "../../../fig_pdfs/fig_PrtInh/", 
       width = 6.5, 
       height = 5)


ggsave(filename = "prtIn.pdf",
       plot = l.m.r, 
       path = "../../../fig_pdfs/fig_PrtInh/", 
       width = 6.5, 
       height = 5)

write_rds(x = l.m.r, file = "../../../fig_pdfs/fig_PrtInh/fig_prtIn.rds")
```

#Supplmental figures
Supp : mean gfp int + mean norm. gfp Int, Noise in GFP intensities, the transient cv2 for the rest of the concentrations. 
##Panel A: mean gfp intensity vs time
```{r}
mean.gfp.plt <-timeseries.prtIn %>%
  group_by(treatment, cell.id) %>%
  mutate(norm.gfp = gfpMeanBgAFsub/gfpMeanBgAFsub[1]) %>% 
  group_by(treatment, image.no) %>% 
  summarise(cv = sd(gfpMeanBgAFsub)/mean(gfpMeanBgAFsub),
            n.cell = NROW(gfpMeanBgAFsub), 
            time.min = mean(delta.time/60), 
            mean.gfp = mean(gfpMeanBgAFsub), 
            mean.norm.gfp = mean(norm.gfp)) %>% 
  group_by(treatment) %>% 
  mutate(norm.cv = cv/cv[1]) %>% 
  dplyr::rename("Treatment" = "treatment") %>% 
  ggplot(.,aes(x = time.min, y = mean.gfp, color = Treatment))+
  geom_point(size = 0.1)+
  geom_smooth(size = 0.2, se = F)+
  scale_color_manual(values = c("seagreen4","lightskyblue4","dodgerblue4","indianred4"),
                     name = NULL)+
  # guides(color = "none", shape = "none")+
  ylab(TeX("Mean GFP intensity"))+
  xlab("Time (mins)")+
  labs(title = "A")+
  theme_pubr()+
  theme(text = element_text(size = 8), 
        legend.background = element_blank(),
        legend.direction = "horizontal",
        legend.position = c(0.5, 1),
        legend.key.size = unit(2 ,"mm"),
        axis.line = element_line(size = 0.1),
        axis.ticks = element_line(size = 0.2),
        axis.title.x = element_blank(), 
        plot.background = element_blank())+
   scale_x_continuous(breaks = c(0,5,10,15,20,25), limits = c(0,25))

mean.gfp.plt
```

##Panel B: changes in mean normalized GFP
```{r}
mean.norm.gfp.plt <- timeseries.prtIn %>% 
  group_by(treatment, cell.id) %>%
  mutate(norm.gfp = gfpMeanBgAFsub/gfpMeanBgAFsub[1]) %>% 
  group_by(treatment, image.no) %>% 
  summarise(cv = sd(gfpMeanBgAFsub)/mean(gfpMeanBgAFsub),
            n.cell = NROW(gfpMeanBgAFsub), 
            time.min = mean(delta.time/60), 
            mean.gfp = mean(gfpMeanBgAFsub), 
            mean.norm.gfp = mean(norm.gfp)) %>% 
  group_by(treatment) %>% 
  mutate(norm.cv = cv/cv[1]) %>% 
  dplyr::rename("Treatment" = "treatment") %>% 
  ggplot(.,aes(x = time.min, y = mean.norm.gfp, color = Treatment))+
  geom_point(size = 0.1)+
  geom_smooth(size = 0.2, se = F)+
  scale_color_manual(values = c("seagreen4","lightskyblue4","dodgerblue4","indianred4"),
                     name = NULL)+
  guides(shape = "none", color = "none")+
  ylab("Mean normalized \nGFP Intensity")+
  xlab("Time (mins)")+
  theme_pubr()+
  theme(text = element_text(size = 8), 
        legend.background = element_blank(),
        legend.direction = "horizontal",
        legend.position = c(0.25,0.2),
        legend.key.size = unit(2 ,"mm"),
        axis.line = element_line(size = 0.1),
        axis.ticks = element_line(size = 0.2))+
   scale_x_continuous(breaks = c(0,5,10,15,20,25), limits = c(0,25))+
  labs(title = "B")

mean.norm.gfp.plt
```
##Panel C: 
bootstrapping CVs in GFP at t = 0
```{r}
#cv in gfp
cv.gfp.boot.fn <- function(data, i){
  data1 <- data %>% 
    ungroup() 
  
  a1 <- data1[i,]
  
  cv <- sd(a1$gfp.mean.bg.af.sub.new)/mean(a1$gfp.mean.bg.af.sub.new)
  return(cv)
}

set.seed(1)
#gfp cv bootstrap
cv.gfp.prtInh.boot.lst <- cv.thalf.PrtIn%>% 
  split(list(.$treatment)) %>% 
  map(.,function(a){
    boot(data = a, statistic = cv.gfp.boot.fn, R = 2000)
  })

#CI
cv.prtInh.gfp.ci <- cv.gfp.prtInh.boot.lst %>% 
  map(.,function(b){
    boot.ci(boot.out = b, conf = 0.95, type = "bca")
  })

cv.prtInh.gfp.ci
```
making df
```{r}
cv.gfp.prtInh.boot.df <- cv.gfp.prtInh.boot.lst%>% 
  map(.,summary %>% as.data.frame) %>% bind_rows(.id = "treatment")

cv.prtInh.gfp.ci.df <- cv.prtInh.gfp.ci %>% 
  map(.,function(a){
    data.frame(ci.low = a$`bca`[4],
               ci.high = a$`bca`[5])
  }) %>% 
  bind_rows(.id = "treatment")

cv.prtInh.gfp.df <- cv.gfp.prtInh.boot.df %>% 
  left_join(.,cv.prtInh.gfp.ci.df, by = "treatment")

```
###Plot
```{r}
cv.gfp.prtin.plt <- cv.prtInh.gfp.df %>% 
  mutate(treatment =  factor(treatment, levels = c("DMSO","1uM","2.5uM","5uM"))) %>% 
  ggplot(.,aes(y = value.original, 
               x = treatment))+
  geom_col(width = 0.2, position = "dodge")+
  geom_errorbar( aes(x=treatment, ymin=ci.low, ymax=ci.high), 
                 width=0.15, size=0.3,
                 position = position_dodge(0.2))+
  ylab(bquote(atop("Noise"~ (italic(CV)), "in GFP intensities at t = 0"))) +
  labs(title ="C")+
  theme_pubr()+
  theme(axis.title.x = element_blank(), 
        axis.line = element_line(size = 0.1),
        axis.ticks = element_line(size = 0.2),
        text = element_text(size = 8), 
        legend.position = c(0.4,0.9), 
        legend.direction = "horizontal", 
        legend.background = element_blank(), 
        legend.key.size = unit(3 ,"mm"),
        legend.spacing.y = unit(-0.25, "cm"),
        plot.background = element_rect(fill = "transparent"))
cv.gfp.prtin.plt
```
##Panel D: 
```{r}
transCVt.rest.plt <- ci_cv2.prtInh %>% 
  left_join(.,mech.noise.df, by = c("Treatment","image.no")) %>% 
  dplyr::select(Treatment, image.no, time.min, norm.cv2,lower,upper,fits.cvd) %>% 
  filter(Treatment %in% c("DMSO","1uM","2.5uM")) %>% 
  mutate(Treatment = factor(Treatment, levels = c("DMSO","1uM","2.5uM","5uM"))) %>% 
  ggplot(.,aes(x = time.min, y = norm.cv2, color = Treatment))+
  geom_point(size = 0.35)+
  geom_errorbar(aes(x = time.min, ymin = lower, ymax = upper,color = Treatment),
                width = 0.2, size = 0.2, 
                position = position_dodge(0.2))+
  geom_line(data = mech.noise.df %>% 
               filter(Treatment %in% c("DMSO","1uM","2.5uM")) ,aes(x = time.min, y = fits.cvd), 
            size= 0.3)+
  scale_color_manual(values = c("seagreen4","lightskyblue4","dodgerblue4"), name = NULL, 
                     labels = c("DMSO           ",
                                expression(paste("1",mu,"M MG132  ")),
                                expression(paste("2.5",mu,"M MG132"))))+
  theme_pubr()+
  theme(text = element_text(size = 8), 
        strip.background = element_blank(),
        legend.background = element_blank(),
        legend.direction = "vertical",
        legend.key.size = unit(4,"mm"),
        legend.position = c(0.25,1),
        axis.line = element_line(size = 0.1),
        axis.ticks = element_line(size = 0.2))+
  scale_x_continuous(breaks = c(0,5,10,15,20,25), limits = c(0,25))+
  scale_y_continuous(breaks = seq(1,8, by = 0.5), limits = c(0.5,8))+
  ylab(bquote(atop("Normalized noise"~ (italic(CV^2)), "in GFP intensities")))+
  xlab("Time (mins)")+
  labs(title = "D")

transCVt.rest.plt
```
##Patchwork
```{r}
p1 <- mean.gfp.plt
p2 <- mean.norm.gfp.plt
p3.1 <- cv.gfp.prtin.plt
p3 <- transCVt.rest.plt 

l <- (p1/plot_spacer()/p2)+
  plot_layout(heights = c(1,-0.1,1))
              # , guides = "collect")&theme(legend.position = "bottom")
r <- (p3.1/plot_spacer()/p3)+
  plot_layout(heights = c(0.35,-0.05,0.5), 
              widths = c(0.5,1,1))

sup.fig <- (l | plot_spacer() |r)+
  plot_layout(widths = c(0.5,-0.05,0.5))

sup.fig
```
##Saving figures
```{r}
ggsave(plot = sup.fig, filename = "prtIn_sup.pdf", path = "../../../fig_pdfs/Sfig_PrtInh/", 
       width = 6, height = 4)

 ggsave(plot = sup.fig, filename = "prtIn_sup.png", path =  "../../../fig_pdfs/Sfig_PrtInh/", 
       width = 6, height = 4)

sup.fig %>% 
write_rds(., file = "../../../fig_pdfs/Sfig_PrtInh//Sfig_prtIn.rds")
```


