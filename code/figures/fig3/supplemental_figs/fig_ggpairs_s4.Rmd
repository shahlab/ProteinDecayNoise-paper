---
title: "Correlations"
output: html_notebook
---
```{r}
library(tidyverse)
library(ggplot2)
library(GGally)
```

estimated parameter values
```{r}
aic.df <- read_csv("~/plots/all_data/aic.csv")
```

#add the replicate info 
```{r}

aic.df <- aic.df %>% 
  mutate(exp.field = paste0(str_split(cell.id, "_", simplify = T)[,2],"_",
                            str_split(cell.id, "_", simplify = T)[,3]),
    colony = case_when(exp.field %in% c("20min_s3", "20min_s4") ~ "Replicate 1", 
                            exp.field %in% c("20min_s5", "20min_s6") ~ "Replicate 2",
                            exp.field %in% c("20min_s7", "20min_s8" , "20min_s9") ~ "Replicate 3"))

aic.df <- aic.df %>% 
  mutate(colony = ifelse(degron == "stable" & red == "pup1-rfp", 
                         case_when(exp.field %in% c("20min_s4", "20min_s5") ~ "Replicate 1",
                                   exp.field %in% c("20min_s6", "20min_s7") ~ "Replicate 2",
                                   exp.field %in% c("20min_s8", "20min_s9") ~ "Replicate 3"), colony)) 
  # filter(value < 0.05)
  
```

Cellular attributes
```{r}
pup1.cell.attr <- read_csv("~/plots/all_data/all_pup1_cell_attr.csv")
```

#pup1-RFP background
```{r}
pup1.cell.attr <- pup1.cell.attr %>% 
  mutate(exp.field = paste0(str_split(cell.id, "_", simplify = T)[,2],"_",
                            str_split(cell.id, "_", simplify = T)[,3]),
    colony = case_when(exp.field %in% c("20min_s3", "20min_s4") ~ "Replicate 1", 
                            exp.field %in% c("20min_s5", "20min_s6") ~ "Replicate 2",
                            exp.field %in% c("20min_s7", "20min_s8" , "20min_s9") ~ "Replicate 3"))

pup1.cell.attr <- pup1.cell.attr %>% 
  mutate(colony = ifelse(degron == "stable" & red == "pup1-rfp", 
                         case_when(exp.field %in% c("20min_s4", "20min_s5") ~ "Replicate 1",
                                   exp.field %in% c("20min_s6", "20min_s7") ~ "Replicate 2",
                                   exp.field %in% c("20min_s8", "20min_s9") ~ "Replicate 3"), colony)) 
  
```

```{r}
#removing the 40min and 60min experiments from the stable gfp experiments
pup1.cell.attr <- pup1.cell.attr %>%
  mutate(exp = str_split(exp.field, "_", simplify = T)[,1]) %>% 
  filter(exp == "20min")
```


```{r}
pup1.cell.attr <- read_csv("~/plots/pup1-rfp-gfp-decay/4-28-21-8hrGFP/data/gfp_stable_filtered.csv") %>% 
  filter(image.no == 1) %>% 
  dplyr::select(cell.id, gfpSumBgAFsub) %>% 
  mutate(cell.id = paste0(cell.id,"_","stable_pup1-rfp_none")) %>% 
  dplyr::rename("gfp.sum.bg.af.sub" = "gfpSumBgAFsub") %>% 
  left_join(pup1.cell.attr %>% 
              filter(degron == "stable") %>% 
              dplyr::select(-gfp.sum.bg.af.sub),., by = "cell.id") %>% 
  bind_rows(pup1.cell.attr %>% 
              filter(degron != "stable"),.)
```

```{r}
multiple.pup1 <- pup1.cell.attr %>% 
  mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
         rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta)) %>% 
  filter(rfp.mean.bg.sub.puncta > 0) %>% 
  group_by(cell.id) %>% 
  tally() %>% 
  filter(n>1)

pup1.cell.attr<- pup1.cell.attr %>% 
  group_by(cell.id) %>% 
  mutate(rfp.mean.bg.sub.puncta = ifelse(cell.id %in% multiple.pup1$cell.id , mean(rfp.mean.bg.sub.puncta), rfp.mean.bg.sub.puncta )) %>% 
    distinct(cell.id, .keep_all = TRUE) 
```

#proteasome inhibition experiments
```{r}
protInhi.attr <- read_csv("~/plots/all_data/all_mg135_attr.csv") %>% 
  rename("cell.id" = "unique.trackID") %>% 
  filter(timepoint == 1) %>% 
  mutate(cell.id = paste0(cell.id ,"_",degron,"_",red,"_",treatment)) %>% 
  mutate(exp.field = paste0(str_split(cell.id, "_", simplify = T)[,2],"_",
                            str_split(cell.id, "_", simplify = T)[,3]),
    colony = case_when(exp.field %in% c("20min_s3", "20min_s4") ~ "Replicate 1", 
                            exp.field %in% c("20min_s5", "20min_s6") ~ "Replicate 2",
                            exp.field %in% c("20min_s7", "20min_s8" , "20min_s9") ~ "Replicate 3"))

multiple.proInh <- protInhi.attr %>% 
  mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
         rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta)) %>% 
  filter(rfp.mean.bg.sub.puncta > 0) %>% 
  group_by(cell.id) %>% 
  tally() %>% 
  filter(n>1)

protInhi.attr <- protInhi.attr %>% 
  group_by(cell.id) %>% 
  mutate(rfp.mean.bg.sub.puncta = ifelse(cell.id %in% multiple.proInh$cell.id , mean(rfp.mean.bg.sub.puncta), rfp.mean.bg.sub.puncta),
         rfp.sum.bg.sub.puncta = ifelse(cell.id %in% multiple.proInh$cell.id, sum(rfp.mean.bg.sub.puncta), rfp.sum.bg.sub.puncta)) %>% 
    distinct(cell.id, .keep_all = TRUE)  
  

```

```{r}
pup1.proInhi.attr <- pup1.cell.attr %>% 
  bind_rows(.,protInhi.attr %>% 
              dplyr::select(-time, 
                            -timepoint,
                            -image.no, 
                            -ln.gfp, 
                            -ln.gfp.dif,
                            -trackID,
                            -gfp.intensity.center,
                            -gfp.int.mean,
                            -gfp.int.median,
                           -gfp.int.sum,
                           -no.of.triangles,
                           -field,
                           -time.dif.gfp,
                           -real.time.gfp,
                           -sample,
                           -avg.gfp.bg,
                           -Min_gfp,
                           -gfp.mean.bg.sub,
                           -value,
                           -t80,
                           -t95,
                           -threshold,
                           -threshold_95,
                           -gfp.mean.bg.af.sub,
                           -threshold_80,
                           -Mean_gfp,
                           -image,
                           -experiment,
                           -gfp.sum.bg.sub))
```

#selecting the dy values from the 2-parameter maturation model
```{r}
# dy.pup1.rep1.all <- aic.df %>% 
#   filter(red == "pup1-rfp", treatment == "none", degron %in% c("cln2.3","mODC.2", "stable.2") ) %>% 
#   filter(ifelse(degron == "stable.2", dy < 0.1, dy < 0.5)) %>% 
#   group_by(cell.id) %>% 
#   # filter(model == "exponential") 
#   filter(ifelse(degron == "mODC.2", model == "dy.dm", model == "exponential")) %>%
#   mutate(dm = ifelse(is.na(dm), Inf, dm)) %>%
#   filter( dm > 0.00001)
# 
# dy.pup1.rep1 <- aic.df %>% 
#   filter(red == "pup1-rfp", treatment == "none", degron %in% c("cln2.3","mODC.2", "stable.2") ) %>% 
#   filter(ifelse(degron == "stable.2", dy < 0.1, dy < 0.5)) %>% 
#   group_by(cell.id) %>% 
#   filter(model == "exponential") 
#   # filter(ifelse(degron == "mODC.2", model == "dy.dm", model == "exponential")) %>%
#   # mutate(dm = ifelse(is.na(dm), Inf, dm)) %>%
#   # filter( dm > 0.00001)

#only dy.dm
dy.pup1.rep1.mat <- aic.df %>% 
  filter(red == "pup1-rfp" ) %>% 
  filter(ifelse(degron %in% c( "stable","stable.3","stable.2"), dy < 0.1, dy < 0.5)) %>% 
  group_by(cell.id) %>% 
  filter(model == "dy.dm") %>% 
  mutate(dm = ifelse(is.na(dm), Inf, dm)) %>%
  filter( dm > 0.00001)
```

#with exponential model for all the GFPs
```{r}
fig2.df <- dy.pup1.rep1 %>% 
  left_join(.,pup1.cell.attr %>%
              filter(red == "pup1-rfp", treatment == "none", degron %in% c("cln2.3","mODC.2", "stable.2")), by = c("cell.id","treatment","degron","red","colony","exp.field"))

multiple.pup1 <- fig2.df %>% 
  mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
         rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta)) %>% 
  filter(rfp.mean.bg.sub.puncta > 0) %>% group_by(cell.id) %>% tally() %>% filter(n>1)

fig2.df <- fig2.df %>% 
  group_by(cell.id) %>% 
  mutate(rfp.mean.bg.sub.puncta = ifelse(cell.id %in% multiple.pup1$cell.id , mean(rfp.mean.bg.sub.puncta), rfp.mean.bg.sub.puncta )) %>% 
    distinct(cell.id, .keep_all = TRUE) 
```

#with dy.dm model for mODC and exponential for cln2 and canonical GFP
```{r}
fig2.df.all <- dy.pup1.rep1.all %>% 
  left_join(.,pup1.cell.attr %>%
              filter(red == "pup1-rfp", treatment == "none", degron %in% c("cln2.3","mODC.2", "stable.2")), by = c("cell.id","treatment","degron","red","colony","exp.field"))

multiple.pup1 <- fig2.df.all %>% 
  mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
         rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta)) %>% 
  filter(rfp.mean.bg.sub.puncta > 0) %>% group_by(cell.id) %>% tally() %>% filter(n>1)

fig2.df.all <- fig2.df.all %>% 
  group_by(cell.id) %>% 
  mutate(rfp.mean.bg.sub.puncta = ifelse(cell.id %in% multiple.pup1$cell.id , mean(rfp.mean.bg.sub.puncta), rfp.mean.bg.sub.puncta )) %>% 
    distinct(cell.id, .keep_all = TRUE) 
```

#with dy.dm model for all the exp
```{r}
fig2.df.mat <- dy.pup1.rep1.mat %>% 
  left_join(.,pup1.proInhi.attr %>%
              filter(red == "pup1-rfp"), by = c("cell.id","treatment","degron","red","colony","exp.field")) %>% 
  mutate(rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0, rfp.mean.bg.sub.puncta)) %>% 
  filter(rfp.mean.bg.sub.puncta > 0)

```

#filter for SSE < 0.05
```{r}
fig2.df.2 <- fig2.df %>% filter(value< 0.05)
fig2.df.all.2 <- fig2.df.all %>% filter(value< 0.05)

fig2.df.mat <- fig2.df.mat %>% filter(value< 0.05)
```


#customed ggpairs function 
```{r}

my_fn <- function(data, mapping, ...){
  p <- ggplot(data = data, mapping = mapping) + 
    ggpointdensity::geom_pointdensity(size = 0.1)+
    # geom_point(size = 0.1, alpha = 0.1) + 
    geom_smooth(method="lm",  color="red4", se = FALSE, lwd = 0.5)
  p
}

ggpairs.custome <- function(df){
  ggpairs.plot <- df %>%  
  mutate(colony = case_when(colony == "Replicate 1" ~ "1",
                            colony == "Replicate 2" ~ "2",
                            colony == "Replicate 3" ~ "3")) %>% 
  ungroup() %>% 
  select(dm,
    # colony,
    gfp.mean.bg.af.sub.new, 
    # gfp.sum.bg.af.sub, 
    rfp.mean.bg.sub.puncta, 
    # rfp.sum.bg.sub.puncta,
    dapi.sum.bg.sub.puncta, 
    area,
    # volume,
    # no.of.voxels,
    # area.puncta,
    elipe_shape,
    # dy,#removed t.half and added dy
    t.half) %>% 
  rename("GFP" = "gfp.mean.bg.af.sub.new",
         # "GFP.sum" = "gfp.sum.bg.af.sub",
         "Pup1- tDimer" = "rfp.mean.bg.sub.puncta",
         # "rfp.sum" = "rfp.sum.bg.sub.puncta",
         "Dapi" = "dapi.sum.bg.sub.puncta",
         "Area" = "area",
         # "voxels" = "no.of.voxels",
         # "Nuclear Size" = "area.puncta",
         "Shape" = "elipe_shape",
         # "rate of decay" = "dy",
         "Half-Life [min.]" = "t.half",
         "Rate of Maturation" = "dm") %>%
         # "Replicate" = "colony") %>% 
  ggpairs(.,
          # legend = 1,
          columns = 1:7,
          # mapping = ggplot2::aes(color = Replicate),
          lower = list(continuous = my_fn,
                      discrete = "blank", 
                      combo="blank"), 
           diag = list(discrete="barDiag", 
                      continuous = wrap("densityDiag", alpha=0.5 )),
          upper = list(discrete= wrap("barDiag" , outlier.size = 0.5),
                       combo = wrap("box_no_facet", outlier.size = 0.5),
                       continuous = wrap("cor", display_grid = FALSE, size = 2.5 , method = "pearson", color = "red4")),
          labeller = label_wrap_gen(width = 2, multi_line = TRUE), 
          proportions = c())+
  theme_bw()+
  theme(text = element_text(size = 6),
        legend.position = "bottom",
        panel.grid.major = element_blank(),
        axis.text.x = element_text(angle = 30, hjust = 1))
  # scale_fill_brewer( palette = "Set2")+
  # scale_color_brewer(palette = "Set2")+
  
  return(ggpairs.plot)
}
```

mODC correlations based on the dm values
```{r}
#dm <1
fig2.df.all %>% 
  mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
         rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta),
         dm = ifelse(is.na(dm), Inf, dm),
         elipe_shape = Elip_B/Elip_C, 
         t.half = log(2)/dy) %>% 
  filter(degron == "mODC.2",
         rfp.mean.bg.sub.puncta > 0, 
         dm < 1) %>% 
  mutate(colony = case_when(colony == "Replicate 1" ~ "1",
                            colony == "Replicate 2" ~ "2",
                            colony == "Replicate 3" ~ "3")) %>% 
  ungroup() %>% 
  select(colony,
    t.half, gfp.mean.bg.af.sub.new, rfp.mean.bg.sub.puncta, dapi.sum.bg.sub.puncta, area, elipe_shape) %>%
  rename("gfp.m" = "gfp.mean.bg.af.sub.new",
         "pup1" = "rfp.mean.bg.sub.puncta",
         "dapi" = "dapi.sum.bg.sub.puncta") %>% 
  ggpairs(.,legend = 1,
          columns = 1:7,
    mapping = ggplot2::aes(color = colony),
         lower = list(continuous = wrap("smooth", se = F, alpha = 0.5, size = 0.1) ), 
          upper = list(continuous = wrap("cor", size = 2.5)))+
  theme(text = element_text(size = 8),
        legend.position = "bottom")


#dm > 1
fig2.df.all %>% 
  mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
         rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta),
         dm = ifelse(is.na(dm), Inf, dm),
         elipe_shape = Elip_B/Elip_C, 
         t.half = log(2)/dy) %>% 
  filter(degron == "mODC.2",
         rfp.mean.bg.sub.puncta > 0, 
         dm > 1) %>% 
  mutate(colony = case_when(colony == "Replicate 1" ~ "1",
                            colony == "Replicate 2" ~ "2",
                            colony == "Replicate 3" ~ "3")) %>% 
  ungroup() %>% 
  select(colony,
    t.half, gfp.mean.bg.af.sub.new, rfp.mean.bg.sub.puncta, dapi.sum.bg.sub.puncta, area, elipe_shape) %>%
  rename("gfp.m" = "gfp.mean.bg.af.sub.new",
         "pup1" = "rfp.mean.bg.sub.puncta",
         "dapi" = "dapi.sum.bg.sub.puncta") %>% 
  ggpairs(.,legend = 1,
          columns = 1:7,
    mapping = ggplot2::aes(color = colony),
         lower = list(continuous = wrap("smooth", se = F, alpha = 0.5, size = 0.1) ), 
          upper = list(continuous = wrap("cor", size = 2.5)))+
  theme(text = element_text(size = 8),
        legend.position = "bottom")

```

df with filtration on SSE < 0.05
```{r}
# fig2.df.2 %>% 
#   mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
#          rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta),
#          elipe_shape = Elip_B/Elip_C, 
#          t.half = log(2)/dy) %>% 
#   filter(degron == "mODC.2",rfp.mean.bg.sub.puncta > 0) %>% 
#   ggpairs.custome(.)


modc.ggp.plt <- fig2.df.mat %>% 
  filter(dm > 0.000015) %>% 
  mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
         rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta),
         elipe_shape = Elip_B/Elip_C, 
         t.half = log(2)/dy,
         dm = log10(dm)) %>% 
  filter(degron == "mODC.2",rfp.mean.bg.sub.puncta > 0) %>% 
  ggpairs.custome(.)+
  ggtitle("Single-Cell Correlations of Various Cellular Features of GFP-mODC strain")

modc.ggp.plt
```

#without the SSE <0.05 filter for mODC
```{r}
modc.ggp.plt <- fig2.df.mat %>% 
  mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
         rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta),
         elipe_shape = Elip_B/Elip_C, 
         t.half = log(2)/dy) %>% 
  filter(degron == "mODC.2",rfp.mean.bg.sub.puncta > 0) %>% 
  ggpairs.custome(.)+
  ggtitle("Single-Cell Correlations of Various Cellular Features of GFP-mODC strain")


# fig2.df.all.2 %>% 
#   mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
#          rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta),
#          elipe_shape = Elip_B/Elip_C, 
#          t.half = log(2)/dy) %>% 
#   filter(degron == "mODC.2",rfp.mean.bg.sub.puncta > 0) %>% 
#   ggpairs.custome(.)



modc.ggp.plt
```

#with proteasome inhibitors
```{r}
trt.list <- fig2.df.mat %>% 
  filter(dm > 0.000015) %>% 
  mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
         rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta),
         elipe_shape = Elip_B/Elip_C, 
         t.half = log(2)/dy,
         dm = log10(dm)) %>% 
  filter(rfp.mean.bg.sub.puncta > 0, treatment != "none") %>% split(.$treatment)  
  

lapply(trt.list, function(a){
  a %>% 
    ggpairs.custome(.)+
    ggtitle(a$treatment[1])
})


```

for CLN2-GFP
```{r}
# fig2.df %>% 
#   mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
#          rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta),
#          elipe_shape = Elip_B/Elip_C, 
#          t.half = log(2)/dy) %>% 
#   filter(degron == "cln2.3", rfp.mean.bg.sub.puncta > 0) %>%
#   ggpairs.custome(.)

#pearson
cln2.ggp.plt.1 <- fig2.df.mat %>% 
  mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
         rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta),
         elipe_shape = Elip_B/Elip_C, 
         t.half = log(2)/dy,
         dm = log10(dm)) %>% 
  filter(degron == "cln2.3", rfp.mean.bg.sub.puncta > 0) %>%
  ggpairs.custome(.)+
  ggtitle("Single-Cell Correlations of Various Cellular Features of GFP-CLN2 strain")

cln2.ggp.plt.2 <- fig2.df.mat %>% 
  mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
         rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta),
         elipe_shape = Elip_B/Elip_C, 
         t.half = log(2)/dy,
         dm = log10(dm)) %>% 
  filter(degron == "cln2.4", rfp.mean.bg.sub.puncta > 0) %>%
  ggpairs.custome(.)+
  ggtitle("Single-Cell Correlations of Various Cellular Features of GFP-CLN2 strain (10-7-22)")


cln2.ggp.plt.1
cln2.ggp.plt.2

#if you pick hte maturation model for all the degrons
# fig2.df.mat %>% 
#   filter(value < 0.05) %>% 
#   mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
#          rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta),
#          elipe_shape = Elip_B/Elip_C, 
#          t.half = log(2)/dy) %>% 
#   filter(degron == "cln2.3", rfp.mean.bg.sub.puncta > 0) %>%
#   ggpairs.custome(.)+
#   ggtitle("Single-Cell Correlations of various cellular features")

cln2.ggp.plt.comb <- fig2.df.mat %>% 
  mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
         rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta),
         elipe_shape = Elip_B/Elip_C, 
         t.half = log(2)/dy,
         dm = log10(dm)) %>% 
  filter(degron %in% c("cln2.3","cln2.4"), rfp.mean.bg.sub.puncta > 0) %>%
  mutate(degron = ifelse(degron %in% c("cln2.3","cln2.4"), "GFP-CLN2", degron)) %>% 
  ggpairs.custome(.)+
  ggtitle("Single-Cell Correlations of Various Cellular Features of GFP-CLN2")
cln2.ggp.plt.comb
```

The relationship does'nt change when you use dy from dy.dm or exponential model for the CLN2.3 experiment 

```{r}
stable.ggp.plt.1 <- fig2.df.mat %>% 
  mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
         rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta),
         elipe_shape = Elip_B/Elip_C,
         t.half = log(2)/dy,
         dm = log10(dm)) %>% 
  filter(degron == "stable.2", rfp.mean.bg.sub.puncta > 0) %>% 
  ggpairs.custome(.)+
  ggtitle("Single-Cell Correlations of Various Cellular Features of GFP strain")


stable.ggp.plt.2 <- fig2.df.mat %>% 
  mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
         rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta),
         elipe_shape = Elip_B/Elip_C,
         t.half = log(2)/dy,
         dm = log10(dm)) %>% 
  filter(degron == "stable.3", rfp.mean.bg.sub.puncta > 0) %>% 
  ggpairs.custome(.)+
  ggtitle("Single-Cell Correlations of Various Cellular Features of GFP strain (10-7-22)")

stable.ggp.plt.1
stable.ggp.plt.2



# fig2.df %>% 
#   mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
#          rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta),
#          elipe_shape = Elip_B/Elip_C,
#          t.half = log(2)/dy) %>% 
#   filter(degron == "stable.2", rfp.mean.bg.sub.puncta > 0) %>% 
#   ggpairs.custome(.)

# fig2.df.mat %>% filter(value < 0.05) %>% 
#   mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
#          rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta),
#          elipe_shape = Elip_B/Elip_C,
#          t.half = log(2)/dy) %>% 
#   filter(degron == "stable.2", rfp.mean.bg.sub.puncta > 0) %>% 
#   ggpairs.custome(.)

stable.ggp.plt.comb <- fig2.df.mat %>% 
  mutate(dapi.mean.bg.sub.puncta = ifelse(is.na(dapi.mean.bg.sub.puncta), 0, dapi.mean.bg.sub.puncta) , 
         rfp.mean.bg.sub.puncta = ifelse(is.na(rfp.mean.bg.sub.puncta), 0 , rfp.mean.bg.sub.puncta),
         elipe_shape = Elip_B/Elip_C,
         t.half = log(2)/dy,
         dm = log10(dm)) %>% 
  filter(degron %in% c("stable.2","stable.3"), rfp.mean.bg.sub.puncta > 0) %>% 
  mutate(degron = ifelse(degron %in% c("stable.2","stable.3"), "yeGFP", degron)) %>% 
  ggpairs.custome(.)+
  ggtitle("Single-Cell Correlations of Various Cellular Features of yeGFP")
stable.ggp.plt.comb
```

#supplemental figure 4 
```{r}
ggsave(plot = cln2.ggp.plt.1,  path = "~/plots/paper1/figures/fig_2/supplemental_figs/", filename = "figs4a.pdf", width = 8, height = 5)
ggsave(plot = cln2.ggp.plt.1,  path = "~/plots/paper1/figures/fig_2/supplemental_figs/", filename = "figs4a.png", width = 8, height = 5)

ggsave(plot = cln2.ggp.plt.2,  path = "~/plots/paper1/figures/fig_2/supplemental_figs/", filename = "figs4a_2.pdf", width = 8, height = 5)
ggsave(plot = cln2.ggp.plt.2,  path = "~/plots/paper1/figures/fig_2/supplemental_figs/", filename = "figs4a_2.png", width = 8, height = 5)

ggsave(plot = modc.ggp.plt,  path = "~/plots/paper1/figures/fig_2/supplemental_figs/", filename = "figs4b.pdf", width = 8, height = 5)
ggsave(plot = modc.ggp.plt,  path = "~/plots/paper1/figures/fig_2/supplemental_figs/", filename = "figs4b.png", width = 8, height = 5)


ggsave(plot = stable.ggp.plt.1,  path = "~/plots/paper1/figures/fig_2/supplemental_figs/", filename = "figs4c.pdf", width = 8, height = 5)
ggsave(plot = stable.ggp.plt.1,  path = "~/plots/paper1/figures/fig_2/supplemental_figs/", filename = "figs4c.png", width = 8, height = 5)

ggsave(plot = stable.ggp.plt.2,  path = "~/plots/paper1/figures/fig_2/supplemental_figs/", filename = "figs4c_2.pdf", width = 8, height = 5)
ggsave(plot = stable.ggp.plt.2,  path = "~/plots/paper1/figures/fig_2/supplemental_figs/", filename = "figs4c_2.png", width = 8, height = 5)


```

